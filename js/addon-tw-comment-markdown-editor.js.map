{"version":3,"file":"js/addon-tw-comment-markdown-editor.js","sources":["webpack://GUI/./src/addons/addons/tw-comment-markdown-editor/userstyle.css","webpack://GUI/./src/addons/addons/tw-comment-markdown-editor/_runtime_entry.js","webpack://GUI/./src/addons/addons/tw-comment-markdown-editor/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* ÂàáÊç¢ÂºÄÂÖ≥ÂÆπÂô® - ÈõÜÊàêÂà∞ÊãñÂä®Ê†è */\\n.tw-md-toggle-container {\\n  display: flex;\\n  justify-content: flex-end;\\n  align-items: center;\\n  padding: 2px 6px;\\n  background: transparent;\\n  gap: 6px;\\n  position: absolute;\\n  top: 2px;\\n  right: 2px;\\n  z-index: 10;\\n}\\n\\n/* Ê®°ÂºèÊåáÁ§∫Âô® - ÈõÜÊàêÂà∞ÊãñÂä®Ê†è */\\n.tw-md-mode-indicator {\\n  font-size: 14px;\\n  color: var(--editorTheme3-commentText, #888);\\n  margin-right: 8px;\\n  font-weight: 600;\\n  text-transform: uppercase;\\n  letter-spacing: 0.8px;\\n  opacity: 0.8;\\n  transition: all 0.2s ease;\\n  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);\\n}\\n\\n.tw-md-mode-indicator.preview-mode {\\n  color: #4CAF50;\\n  opacity: 1;\\n  font-weight: 600;\\n}\\n\\n/* ÂàáÊç¢ÊåâÈíÆ - ÈõÜÊàêÂà∞ÊãñÂä®Ê†è */\\n.tw-md-toggle-button {\\n  background: rgba(var(--editorTheme3-commentBorder-rgb, 200, 200, 200), 0.3);\\n  color: var(--editorTheme3-commentText, #555);\\n  border: 1px solid rgba(0, 0, 0, 0.1);\\n  border-radius: 6px;\\n  padding: 6px 12px;\\n  font-size: 14px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  opacity: 0.8;\\n  transition: all 0.2s ease;\\n  user-select: none;\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  backdrop-filter: blur(2px);\\n}\\n\\n.tw-md-toggle-button:hover {\\n  opacity: 1;\\n  background: rgba(var(--editorTheme3-commentBorder-rgb, 200, 200, 200), 0.5);\\n}\\n\\n.tw-md-toggle-button:active {\\n  transform: scale(0.95);\\n}\\n\\n.tw-md-toggle-button[data-mode=\\\"preview\\\"] {\\n  background: rgba(76, 175, 80, 0.3);\\n  color: #2E7D32;\\n  border-color: rgba(76, 175, 80, 0.3);\\n}\\n\\n/* È¢ÑËßàÂÆπÂô® - Êó†ËÉåÊôØÊ°Ü */\\n.tw-md-preview-container {\\n  width: 100%;\\n  height: 100%;\\n  padding: 12px;\\n  background: transparent;\\n  color: var(--editorTheme3-commentText, #333);\\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\\n  font-size: 16px;\\n  line-height: 1.7;\\n  white-space: pre-wrap;\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n  box-sizing: border-box;\\n  max-height: 100%;\\n}\\n\\n/* È¢ÑËßàÂÜÖÂÆπÊ†∑Âºè */\\n.tw-md-preview-container h1,\\n.tw-md-preview-container h2,\\n.tw-md-preview-container h3 {\\n  margin-top: 8px;\\n  margin-bottom: 6px;\\n  font-weight: 600;\\n  line-height: 1.3;\\n}\\n\\n.tw-md-preview-container h1 {\\n  font-size: 22px;\\n  color: var(--editorTheme3-commentText, #333);\\n  border-bottom: 2px solid var(--editorTheme3-commentBorder, #ddd);\\n  padding-bottom: 6px;\\n}\\n\\n.tw-md-preview-container h2 {\\n  font-size: 20px;\\n  color: var(--editorTheme3-commentText, #444);\\n}\\n\\n.tw-md-preview-container h3 {\\n  font-size: 18px;\\n  color: var(--editorTheme3-commentText, #555);\\n}\\n\\n\\n.tw-md-preview-container strong {\\n  font-weight: 600;\\n  color: var(--editorTheme3-commentText, #333);\\n}\\n\\n.tw-md-preview-container em {\\n  font-style: italic;\\n  color: var(--editorTheme3-commentText, #444);\\n}\\n\\n.tw-md-preview-container code {\\n  background-color: rgba(0, 0, 0, 0.08);\\n  color: #d73a49;\\n  padding: 3px 8px;\\n  border-radius: 4px;\\n  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;\\n  font-size: 15px;\\n  border: 1px solid rgba(0, 0, 0, 0.1);\\n}\\n\\n/* ÂºïÁî®ÂùóÊ†∑Âºè */\\n.tw-md-preview-container blockquote {\\n  border-left: 4px solid #dfe2e5;\\n  padding: 0 16px;\\n  margin: 8px 0;\\n  color: #6a737d;\\n  background-color: #f8f9fa;\\n  border-radius: 0 4px 4px 0;\\n  font-size: 14px;\\n  line-height: 1.6;\\n}\\n\\n.tw-md-preview-container pre code {\\n  display: block;\\n  padding: 12px 16px;\\n  margin: 8px 0;\\n  overflow-x: auto;\\n  background-color: #f6f8fa;\\n  border-radius: 4px;\\n  font-size: 14px;\\n  line-height: 1.6;\\n}\\n\\n.tw-md-preview-container a {\\n  color: #0366d6;\\n  text-decoration: none;\\n  font-weight: 500;\\n  border-bottom: 1px solid transparent;\\n  transition: border-color 0.2s ease;\\n}\\n\\n.tw-md-preview-container a:hover {\\n  text-decoration: underline;\\n  border-bottom-color: #0366d6;\\n}\\n\\n.tw-md-preview-container ul {\\n  margin: 8px 0;\\n  padding-left: 20px;\\n}\\n\\n.tw-md-preview-container li {\\n  margin: 2px 0;\\n  padding-left: 4px;\\n}\\n\\n.tw-md-preview-container li::marker {\\n  color: var(--editorTheme3-commentText, #666);\\n}\\n\\n/* Á°Æ‰øùÊ≥®ÈáäÊ°ÜÂÜÖÁöÑÊªöÂä®Êù°Ê≠£Â∏∏ÊòæÁ§∫ */\\n.tw-md-preview-container::-webkit-scrollbar {\\n  width: 10px;\\n  height: 10px;\\n}\\n\\n.tw-md-preview-container::-webkit-scrollbar-track {\\n  background: rgba(0, 0, 0, 0.05);\\n  border-radius: 5px;\\n}\\n\\n.tw-md-preview-container::-webkit-scrollbar-thumb {\\n  background: rgba(0, 0, 0, 0.3);\\n  border-radius: 5px;\\n  border: 2px solid transparent;\\n  background-clip: content-box;\\n}\\n\\n.tw-md-preview-container::-webkit-scrollbar-thumb:hover {\\n  background: rgba(0, 0, 0, 0.4);\\n  border: 2px solid transparent;\\n  background-clip: content-box;\\n}\\n\\n/* Á°Æ‰øùÊ≥®ÈáäÊ°ÜÊú¨Ë∫´ÊîØÊåÅÊªöÂä® */\\n.tw-md-preview-container {\\n  scrollbar-width: thin;\\n  scrollbar-color: rgba(0, 0, 0, 0.3) rgba(0, 0, 0, 0.05);\\n}\\n\", \"\"]);\n\n// exports\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userstyle.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userstyle.css\": _css,\n};","export default async function ({ addon, console }) {\n  const vm = addon.tab.traps.vm;\n\n  // Á≠âÂæÖBlocklyÂä†ËΩΩ\n  const Blockly = await addon.tab.traps.getBlockly();\n\n  // Â§ÑÁêÜÊ≥®ÈáäÂÖÉÁ¥†ÁöÑÂáΩÊï∞\n  const processCommentElements = () => {\n    // Â¶ÇÊûúÊèí‰ª∂Ë¢´Á¶ÅÁî®Ôºå‰∏çÂ§ÑÁêÜ‰ªª‰ΩïÂÖÉÁ¥†\n    if (addon.self.disabled) return;\n\n    // Êü•ÊâæÊâÄÊúâÊ≥®ÈáäÂÖÉÁ¥†\n    const commentElements = document.querySelectorAll('.blocklyBubbleCanvas > g');\n\n    commentElements.forEach(commentEl => {\n      // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂ§ÑÁêÜËøá\n      if (commentEl.dataset.markdownProcessed) return;\n\n      // Êü•Êâætextarea\n      const textarea = commentEl.querySelector('textarea');\n      if (!textarea) return;\n\n      // Êü•ÊâæÈ°∂ÈÉ®Ê†èÔºàÊãñÂä®Ê†èÔºâ\n      const topBar = commentEl.querySelector('.scratchCommentBody') || commentEl.querySelector('[class*=\"TopBar\"]') || commentEl.firstElementChild;\n      if (!topBar) return;\n\n      // Ê†áËÆ∞‰∏∫Â∑≤Â§ÑÁêÜ\n      commentEl.dataset.markdownProcessed = 'true';\n\n      // ÂàõÂª∫ÂàáÊç¢ÂºÄÂÖ≥ÂÆπÂô®\n      const toggleContainer = document.createElement('div');\n      toggleContainer.className = 'tw-md-toggle-container';\n\n      // ÂàõÂª∫Ê®°ÂºèÊåáÁ§∫Âô®\n      const modeIndicator = document.createElement('span');\n      modeIndicator.className = 'tw-md-mode-indicator';\n      modeIndicator.textContent = 'ÁºñËæëÊ®°Âºè';\n\n      // ÂàõÂª∫ÂàáÊç¢ÊåâÈíÆ\n      const toggleButton = document.createElement('button');\n      toggleButton.className = 'tw-md-toggle-button';\n      toggleButton.innerHTML = 'üìù ÁºñËæë';\n      toggleButton.dataset.mode = 'edit';\n      toggleButton.title = 'ÂàáÊç¢Âà∞È¢ÑËßàÊ®°Âºè (Ctrl+M)';\n\n      // Â∞ÜÂÖÉÁ¥†Ê∑ªÂä†Âà∞ÂÆπÂô®\n      toggleContainer.appendChild(modeIndicator);\n      toggleContainer.appendChild(toggleButton);\n\n      // ÂàõÂª∫È¢ÑËßàÂÆπÂô®\n      const previewContainer = document.createElement('div');\n      previewContainer.className = 'tw-md-preview-container';\n      previewContainer.style.display = 'none';\n\n      // Â∞ÜÂÖÉÁ¥†Ê∑ªÂä†Âà∞DOM\n      toggleContainer.appendChild(toggleButton);\n      topBar.appendChild(toggleContainer);\n\n      // ÊâæÂà∞Ê≥®ÈáäÂÜÖÂÆπÂå∫ÂüüÂπ∂Ê∑ªÂä†È¢ÑËßàÂÆπÂô®\n      const contentArea = commentEl.querySelector('.scratchCommentTextarea')?.parentElement || textarea.parentElement;\n      if (contentArea) {\n        contentArea.appendChild(previewContainer);\n      }\n\n      // ÂàáÊç¢Ê®°ÂºèÁöÑ‰∫ã‰ª∂Â§ÑÁêÜ\n      toggleButton.addEventListener('click', (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n\n        toggleMode();\n      });\n\n      // ÈîÆÁõòÂø´Êç∑ÈîÆÊîØÊåÅ (Ctrl/Cmd + M) - ÂÖ®Â±ÄÁõëÂê¨\n      document.addEventListener('keydown', (e) => {\n        if ((e.ctrlKey || e.metaKey) && e.key === 'm') {\n          // Ê£ÄÊü•ÊòØÂê¶ÊúâÊ¥ªÂä®ÁöÑÊ≥®ÈáäÁºñËæë - ÈÄöËøáÁÑ¶ÁÇπÂÖÉÁ¥†ÊàñÂΩìÂâçÊ®°Âºè\n          const activeElement = document.activeElement;\n          const isEditingComment = activeElement && (\n            activeElement === textarea ||\n            activeElement.closest('[data-markdown-processed]') === commentEl\n          );\n\n          // Â¶ÇÊûúÂú®ÁºñËæëÊ≠§Ê≥®ÈáäÔºåÊàñËÄÖÂΩìÂâçÂ§Ñ‰∫éÈ¢ÑËßàÊ®°ÂºèÔºåÈÉΩÂÖÅËÆ∏ÂàáÊç¢\n          const isInPreviewMode = toggleButton.dataset.mode === 'preview';\n\n          if ((isEditingComment || isInPreviewMode) && commentEl.dataset.markdownProcessed === 'true') {\n            e.preventDefault();\n            toggleMode();\n          }\n        }\n      });\n\n      // ÂàáÊç¢Ê®°ÂºèÁöÑÂáΩÊï∞\n      function toggleMode() {\n        const mode = toggleButton.dataset.mode;\n        if (mode === 'edit') {\n          // ÂàáÊç¢Âà∞È¢ÑËßàÊ®°Âºè\n          toggleButton.dataset.mode = 'preview';\n          toggleButton.innerHTML = 'üêü È¢ÑËßà';\n          toggleButton.title = 'ÂàáÊç¢Âà∞ÁºñËæëÊ®°Âºè (Ctrl+M)';\n          modeIndicator.textContent = 'È¢ÑËßàÊ®°Âºè';\n          modeIndicator.classList.add('preview-mode');\n          textarea.style.display = 'none';\n          previewContainer.style.display = 'block';\n\n          // Ê∏≤ÊüìMarkdown\n          renderMarkdown(textarea.value, previewContainer);\n        } else {\n          // ÂàáÊç¢Âà∞ÁºñËæëÊ®°Âºè\n          toggleButton.dataset.mode = 'edit';\n          toggleButton.innerHTML = 'üìù ÁºñËæë';\n          toggleButton.title = 'ÂàáÊç¢Âà∞È¢ÑËßàÊ®°Âºè (Ctrl+M)';\n          modeIndicator.textContent = 'ÁºñËæëÊ®°Âºè';\n          modeIndicator.classList.remove('preview-mode');\n          textarea.style.display = 'block';\n          previewContainer.style.display = 'none';\n\n          // ÈáçÊñ∞ËÅöÁÑ¶Âà∞textarea\n          textarea.focus();\n        }\n      }\n\n      // ÂΩìtextareaÂÜÖÂÆπÊîπÂèòÊó∂ÔºåÊõ¥Êñ∞È¢ÑËßà\n      textarea.addEventListener('input', () => {\n        if (toggleButton.dataset.mode === 'preview') {\n          renderMarkdown(textarea.value, previewContainer);\n        }\n      });\n\n      console.log('Processed comment element:', commentEl);\n    });\n  };\n\n  // Â¢ûÂº∫ÁöÑMarkdownÊ∏≤ÊüìÂáΩÊï∞\n  function renderMarkdown(text, container) {\n    // Ê∏ÖÁ©∫ÂÆπÂô®\n    container.innerHTML = '';\n\n    // Â¢ûÂº∫ÁöÑMarkdownÊ∏≤ÊüìÂÆûÁé∞\n    let html = text\n      // ÂºïÁî® - ÂøÖÈ°ªÂú®ÂÖ∂‰ªñÂ§ÑÁêÜ‰πãÂâç\n      .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')\n      // Ê†áÈ¢ò\n      .replace(/^### (.*$)/gm, '<h3>$1</h3>')\n      .replace(/^## (.*$)/gm, '<h2>$1</h2>')\n      .replace(/^# (.*$)/gm, '<h1>$1</h1>')\n      // Á≤ó‰ΩìÂíåÊñú‰Ωì\n      .replace(/\\*\\*(.*?)\\*\\*/gm, '<strong>$1</strong>')\n      .replace(/\\*(.*?)\\*/gm, '<em>$1</em>')\n      // ‰ª£Á†ÅÂùó\n      .replace(/```([\\s\\S]*?)```/gm, '<pre><code>$1</code></pre>')\n      // Ë°åÂÜÖ‰ª£Á†Å\n      .replace(/`(.*?)`/gm, '<code>$1</code>')\n      // ÂõæÁâá\n      .replace(/!\\[([^\\]]*)\\]\\(([^)]+)\\)/gm, '<img src=\"$2\" alt=\"$1\" style=\"max-width: 100%; height: auto; border-radius: 4px; margin: 8px 0;\">')\n      // ÈìæÊé•\n      .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/gm, '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>')\n      // ÂàóË°®È°π\n      .replace(/^\\* (.*$)/gm, '<li>$1</li>')\n      .replace(/^- (.*$)/gm, '<li>$1</li>')\n      // Êç¢Ë°å\n      .replace(/\\n/g, '<br>');\n\n    // Â§ÑÁêÜÂàóË°®\n    html = html.replace(/(<li>.*<\\/li>)/s, '<ul>$1</ul>');\n\n    container.innerHTML = html;\n  }\n\n  // ÁõëÂê¨DOMÂèòÂåñÔºåÂ§ÑÁêÜÊñ∞Ê∑ªÂä†ÁöÑÊ≥®Èáä\n  const observer = new MutationObserver((mutations) => {\n    let shouldProcess = false;\n    mutations.forEach(mutation => {\n      mutation.addedNodes.forEach(node => {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          if (node.matches && node.matches('.blocklyBubbleCanvas > g')) {\n            shouldProcess = true;\n          } else if (node.querySelector && node.querySelector('.blocklyBubbleCanvas > g')) {\n            shouldProcess = true;\n          }\n        }\n      });\n    });\n\n    if (shouldProcess) {\n      setTimeout(processCommentElements, 100);\n    }\n  });\n\n  // ÂºÄÂßãÁõëÂê¨\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n\n  // ÂàùÂßãÂ§ÑÁêÜ\n  setTimeout(processCommentElements, 1000);\n\n  // ÂÆöÊúüÂ§ÑÁêÜÊñ∞ÂÖÉÁ¥†\n  setInterval(processCommentElements, 2000);\n\n  // Êèí‰ª∂Á¶ÅÁî®Êó∂Ê∏ÖÁêÜÂäüËÉΩ\n  addon.self.addEventListener('disabled', () => {\n    // ÁßªÈô§ÊâÄÊúâÊ∑ªÂä†ÁöÑÂàáÊç¢ÂÖÉÁ¥†\n    const toggleContainers = document.querySelectorAll('.tw-md-toggle-container');\n    const previewContainers = document.querySelectorAll('.tw-md-preview-container');\n\n    toggleContainers.forEach(container => container.remove());\n    previewContainers.forEach(container => container.remove());\n\n    // ÈáçÁΩÆÊâÄÊúâÊ≥®ÈáäÂÖÉÁ¥†ÁöÑÂ§ÑÁêÜÁä∂ÊÄÅ\n    const processedElements = document.querySelectorAll('[data-markdown-processed]');\n    processedElements.forEach(el => {\n      delete el.dataset.markdownProcessed;\n      // ÊòæÁ§∫ÊâÄÊúâtextarea\n      const textarea = el.querySelector('textarea');\n      if (textarea) {\n        textarea.style.display = 'block';\n      }\n    });\n\n    console.log('Markdown comment editor addon disabled');\n  });\n\n  // Êèí‰ª∂ÂêØÁî®Êó∂ÈáçÊñ∞Â§ÑÁêÜ\n  addon.self.addEventListener('enabled', () => {\n    setTimeout(processCommentElements, 500);\n    console.log('Markdown comment editor addon enabled');\n  });\n\n  console.log('Markdown comment editor addon loaded');\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAIA;AAAA;AAGA;AAAA;AAEA;AAAA;AAEA;AAAA;AAEA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;A","sourceRoot":""}